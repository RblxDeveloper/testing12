<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Tasks - TaskQuest</title>
    <link rel="stylesheet" href="styles/main.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
</head>
<body class="child-body">
    <nav class="navbar child-nav">
        <div class="nav-brand">
            <span class="logo-icon">‚≠ê</span>
            <span>TaskQuest</span>
        </div>
        <div class="nav-links">
            <a href="#tasks" class="nav-link active" onclick="navigateToSection('tasks'); return false;">Tasks</a>
            <a href="#upload" class="nav-link" onclick="navigateToSection('upload'); return false;">Upload</a>
            <a href="#rewards" class="nav-link" onclick="navigateToSection('rewards'); return false;">Rewards</a>
            <a href="#profile" class="nav-link" onclick="navigateToSection('profile'); return false;">Profile</a>
        </div>
        <button class="logout-btn" onclick="logout()">Logout</button>
    </nav>

    <main class="child-dashboard-container">
        <!-- Points Display -->
        <section class="points-hero">
            <div class="points-card">
                <div class="points-label">Your Points</div>
                <!-- Points will now be loaded dynamically from Firebase -->
                <div class="points-value" id="points-value">0</div>
                <div class="points-subtitle">Keep going! You're doing great! üåü</div>
            </div>
        </section>

        <!-- Available Tasks -->
        <section id="tasks-section" class="child-section">
            <h2 class="section-title">Available Tasks</h2>
            <!-- Grid will be populated dynamically from Firebase -->
            <div class="child-tasks-grid" id="childTasksGrid">
                <p>Loading tasks...</p>
            </div>
        </section>

        <!-- Rewards Store -->
        <section id="rewards-section" class="child-section" style="display: none;">
            <h2 class="section-title">Rewards Store</h2>
            <!-- Grid will be populated dynamically from Firebase -->
            <div class="rewards-store-grid" id="rewardsStoreGrid">
                <p>Loading rewards...</p>
            </div>
        </section>

        <!-- Activity History -->
        <section id="profile-section" class="child-section" style="display: none;">
            <h2 class="section-title">My Profile</h2>
            <!-- Added profile information display -->
            <div class="profile-container">
                <div class="profile-header">
                    <div class="profile-avatar">üë§</div>
                    <h3 id="profileName">Loading...</h3>
                    <p id="profileEmail">Loading...</p>
                </div>
                <div class="profile-stats">
                    <div class="stat-card">
                        <span class="stat-number" id="totalPoints">0</span>
                        <span class="stat-label">Total Points Earned</span>
                    </div>
                    <div class="stat-card">
                        <span class="stat-number" id="completedTasks">0</span>
                        <span class="stat-label">Completed Tasks</span>
                    </div>
                    <div class="stat-card">
                        <span class="stat-number" id="rewardsRedeemed">0</span>
                        <span class="stat-label">Rewards Redeemed</span>
                    </div>
                </div>

                <!-- Family code linking for children -->
                <div class="family-link-card" id="childFamilyLinkCard" style="margin-top:1rem;">
                    <h4>Link to Parent</h4>
                    <p id="linkedParentInfo">Not linked to a family yet.</p>
                    <div class="family-code-input-row">
                        <input type="text" id="childFamilyCodeInput" placeholder="Enter parent's 6-digit family code">
                        <button class="primary-btn" onclick="setFamilyCodeForChild()">Link</button>
                    </div>
                    <p class="hint">Ask your parent for their Family Code and paste it here.</p>
                </div>
            </div>

            <h2 class="section-title" style="margin-top: 2rem;">Activity History</h2>
            <!-- Activity list will be populated dynamically -->
            <div class="activity-list" id="activityList">
                <p>Loading activity history...</p>
            </div>
        </section>
    </main>

    <!-- Upload Task Modal -->
    <div id="uploadModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeUploadModal()">&times;</span>
            <h2>Upload Task Photos</h2>
            <p class="modal-subtitle" id="uploadTaskTitle">Complete your task</p>
            <div class="upload-section">
                <div class="upload-step">
                    <h3>Step 1: Before Photo</h3>
                    <div class="upload-box" id="beforeUploadBox">
                        <input type="file" id="beforePhoto" accept="image/*" onchange="uploadBeforePhoto(event)">
                        <label for="beforePhoto" class="upload-label">
                            <div class="upload-icon">üì∏</div>
                            <div class="upload-text">Click to upload BEFORE photo</div>
                        </label>
                        <div id="beforePreview" class="preview-box"></div>
                    </div>
                </div>

                <div class="upload-step">
                    <h3>Step 2: After Photo</h3>
                    <div class="upload-box" id="afterUploadBox">
                        <input type="file" id="afterPhoto" accept="image/*" onchange="uploadAfterPhoto(event)">
                        <label for="afterPhoto" class="upload-label">
                            <div class="upload-icon">üì∏</div>
                            <div class="upload-text">Click to upload AFTER photo</div>
                        </label>
                        <div id="afterPreview" class="preview-box"></div>
                    </div>
                </div>
            </div>

            <button class="submit-btn" onclick="submitTaskForReview()">Submit for Review</button>
        </div>
    </div>

    <!-- Notification Toast -->
    <div id="notification" class="notification"></div>

    <!-- Firebase App (the core Firebase SDK) -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <!-- Firebase Authentication -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <!-- Firebase Firestore -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    <!-- Firebase Storage -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>

    <script src="scripts/main.js"></script>
</body>
</html>